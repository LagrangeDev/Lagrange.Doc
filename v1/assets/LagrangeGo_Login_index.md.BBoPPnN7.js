import{_ as s,c as i,o as a,aj as t}from"./chunks/framework.rttrbDsz.js";const E=JSON.parse('{"title":"登录前的准备","description":"","frontmatter":{},"headers":[],"relativePath":"LagrangeGo/Login/index.md","filePath":"LagrangeGo/Login/index.md","lastUpdated":1748752474000}'),e={name:"LagrangeGo/Login/index.md"},n=t(`<h1 id="登录前的准备" tabindex="-1">登录前的准备 <a class="header-anchor" href="#登录前的准备" aria-label="Permalink to &quot;登录前的准备&quot;">​</a></h1><p>首先需要确保你已经生成了设备信息(DeviceInfo)和版本信息(AppInfo)，以及与版本信息对应的签名服务器</p><h2 id="创建设备信息" tabindex="-1">创建设备信息 <a class="header-anchor" href="#创建设备信息" aria-label="Permalink to &quot;创建设备信息&quot;">​</a></h2><blockquote><p><code>import &quot;github.com/LagrangeDev/LagrangeGo/client/auth&quot;</code></p></blockquote><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 手动定义各个字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">deviceInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeviceInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GUID:          </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cfac208495d565ef66e7dff9f98764da&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DeviceName:    </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lagrange-DCFCD07E&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SystemKernel:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Windows 10.0.22631&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    KernelVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10.0.22631&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自动生成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">deviceInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auth.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewDeviceInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">114514</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 从文件读取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">deviceInfo,err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auth.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LoadOrSaveDevice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path/to/deviceinfo.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="创建版本信息" tabindex="-1">创建版本信息 <a class="header-anchor" href="#创建版本信息" aria-label="Permalink to &quot;创建版本信息&quot;">​</a></h2><blockquote><p><code>import &quot;github.com/LagrangeDev/LagrangeGo/client/auth&quot;</code></p></blockquote><p><a href="https://github.com/LagrangeDev/LagrangeGo/blob/master/client/auth/app.go" target="_blank" rel="noreferrer">内置版本信息</a></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用内置的版本信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">appInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auth.AppList[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;linux&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3.2.15-30366&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>此外，你还需要准备好与版本对应的签名服务器url</p></div><h2 id="创建一个qqclient实例" tabindex="-1">创建一个<code>qqclient</code>实例 <a class="header-anchor" href="#创建一个qqclient实例" aria-label="Permalink to &quot;创建一个\`qqclient\`实例&quot;">​</a></h2><blockquote><p><code>import &quot;github.com/LagrangeDev/LagrangeGo/client&quot;</code></p></blockquote><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建一个空的client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qqclient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewClientEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h2 id="将之前生成的信息加载进qqclient" tabindex="-1">将之前生成的信息加载进<code>qqclient</code> <a class="header-anchor" href="#将之前生成的信息加载进qqclient" aria-label="Permalink to &quot;将之前生成的信息加载进\`qqclient\`&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设备信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UseDevice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deviceInfo)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 版本信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UseVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appInfo)</span></span></code></pre></div><h2 id="添加签名服务器" tabindex="-1">添加签名服务器 <a class="header-anchor" href="#添加签名服务器" aria-label="Permalink to &quot;添加签名服务器&quot;">​</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddSignServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://sign.lagrangecore.org/api/sign/30366&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h1 id="登录" tabindex="-1">登录 <a class="header-anchor" href="#登录" aria-label="Permalink to &quot;登录&quot;">​</a></h1><h2 id="二维码登录" tabindex="-1">二维码登录 <a class="header-anchor" href="#二维码登录" aria-label="Permalink to &quot;二维码登录&quot;">​</a></h2><ol><li><p>首先获取登录二维码</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qrcode, url, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FecthQRCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 你可以将二维码保存到本地以便扫码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WriteFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path/to/qrcode.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qrcode, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0666</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>返回的元组包括</p><table tabindex="0"><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">备注</th></tr></thead><tbody><tr><td style="text-align:center;"><code>qrcode</code></td><td style="text-align:center;">[]byte</td><td style="text-align:center;">二维码图片数据</td></tr><tr><td style="text-align:center;"><code>url</code></td><td style="text-align:center;">string</td><td style="text-align:center;">二维码内容链接</td></tr><tr><td style="text-align:center;"><code>err</code></td><td style="text-align:center;">error</td><td style="text-align:center;">错误信息</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">提示</p><p>二维码内容链接需要被转换为二维码图片后通过手机 App 扫码登录, 不要直接访问链接</p></div></li><li><p>轮询二维码扫码状态</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retCode, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetQRCodeResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retCode.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Waitable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 二维码在等待扫码或等待确认</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retCode.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Success</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 二维码扫码成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>登录</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 等待扫码完成后即可登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">QRCodeLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div></li></ol><h2 id="密码登录" tabindex="-1">密码登录 <a class="header-anchor" href="#密码登录" aria-label="Permalink to &quot;密码登录&quot;">​</a></h2><blockquote><p>不保证可用性</p></blockquote><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qqclient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PasswordLogin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div>`,25),l=[n];function h(p,k,d,o,r,c){return a(),i("div",null,l)}const y=s(e,[["render",h]]);export{E as __pageData,y as default};
